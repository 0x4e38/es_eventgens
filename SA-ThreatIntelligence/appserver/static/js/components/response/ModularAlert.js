"use strict";define(["jquery","underscore","backbone","splunkjs/mvc","splunkjs/mvc/utils","util/general_utils","uri/route","sa-utils/js/util/Console"],function(a,b,c,d,e,f,g){return c.View.extend({initialize:function(a){this.options=a,this._model=this.options.alert,this._model2=this.options.action,this.name=this._model.name,this.label=this._model2.content.label,this.description=this._model2.content.description,this.configured=!1,this.enabled=!1,this.config={},this._onEnableChange=this.options.onEnableChange||function(){};var b=g.encodeRoot(Splunk.util.getConfigValue("MRSPARKLE_ROOT_PATH","/").slice(1),Splunk.util.getConfigValue("LOCALE","en-US"));this.template=this._model.content["eai:data"].replace(/\{\{SPLUNKWEB_URL_PREFIX}}/g,b)},render:function(){var b=this;this.$el.html(this.template),this.writeFormValues();var c=a("input, select",this.$el);c.each(function(d){a(c[d]).on("change",b.readFormValues.bind(b)),a(c[d]).on("blur",b.readFormValues.bind(b)),a(c[d]).on("keyup",b.readFormValues.bind(b)),a(c[d]).trigger("change")})},getIconUrl:function(){return g.alertActionIconFile(Splunk.util.getConfigValue("MRSPARKLE_ROOT_PATH","/").slice(1),Splunk.util.getConfigValue("LOCALE","en-US"),this._model.acl.app,{file:this._model2.content.icon_path})},_parseCam:function(){var a={supports_adhoc:!1,category:[],task:[],subject:[],vendor:[]};if(this._model2&&this._model2.content&&this._model2.content["param._cam"])try{var b=JSON.parse(this._model2.content["param._cam"]);"boolean"==typeof f.normalizeBoolean(b.supports_adhoc)&&(a.supports_adhoc=b.supports_adhoc),Array.isArray(b.category)&&(a.category=b.category),Array.isArray(b.task)&&(a.task=b.task),Array.isArray(b.subject)&&(a.subject=b.subject),Array.isArray(b.technology)&&(a.vendor=b.technology.map(function(a){return a.vendor}))}catch(c){}return a},supportsAdhoc:function(){return this._parseCam().supports_adhoc},getCategories:function(){return this._parseCam().category},getTasks:function(){return this._parseCam().task},getSubjects:function(){return this._parseCam().subject},getVendors:function(){return this._parseCam().vendor},getConfig:function(){var a={};return this.configured&&(a["action."+this.name]=this.enabled?1:0,this.enabled&&(a=b.extend(a,this.config))),a},setConfig:function(a,b){var c=a.split(".");if("action"!==c[0]||c[1]!==this.name)throw"invalid argument";if(this.configured=!0,2===c.length&&c[1]===this.name){var d=this.enabled;this.enabled=1==b,d!==this.enabled&&this._onEnableChange(this.name,this.enabled)}else this.config[a]=b;this.enabled&&this.writeFormValues()},getCustomKeys:function(){return[]},writeFormValues:function(){var b=this;Object.keys(this.config).map(function(c){var d=b.config[c],e=a('input[name="'+c+'"], select[name="'+c+'"]',b.el);if(0!==e.length&&(1===e.length||/radio/i.test(a(e[0]).attr("type")))){var f=a(e[0]).attr("type");if(/checkbox/i.test(f)){e=e[0];var g=e.value;Splunk.util.normalizeBoolean(g)===!0?e.checked=Splunk.util.normalizeBoolean(d):e.checked=d==g}else/radio/i.test(f)?e.each(function(b){a(e[b]).prop("checked",d==a(e[b]).attr("value"))}):e[0].value=d}})},readFormValues:function(b){var c=b.target;if(!c.hasAttribute("name"))return void console.log("ModularAlertManager: cannot handle element");c=a(c)[0];var d=c.name,e=c.type,f=this.config[d];if(/checkbox/i.test(e)){var g=c.value;f=Splunk.util.normalizeBoolean(g)===!0?c.checked?"1":"0":c.checked?g:null}else/radio/i.test(e)?c.checked&&(f=c.value):f=c.value;this.config[d]=f}})});