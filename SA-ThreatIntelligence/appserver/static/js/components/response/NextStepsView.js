"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();define(["jquery","underscore","backbone","sa-threatintelligence/js/components/response/ModularAlertManager","sa-threatintelligence/js/components/incident_review/dialogs/ModularAlertDialog"],function(a,b,c,d,e){var f=function(f){function g(){return _classCallCheck(this,g),_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments))}return _inherits(g,f),_createClass(g,[{key:"events",value:function(){return{"click .step-action-ref":"openDialog"}}},{key:"defaults",value:function(){return{model:{event:new c.Model}}}},{key:"initialize",value:function(a){c.View.prototype.initialize.apply(this,arguments),this.options=b.extend(this.defaults(),a),this.mlm=new d({filterAlerts:function(a){return"notable"===a.name||!a.supportsAdhoc()}})}},{key:"openDialog",value:function(b){var c=[a(b.currentTarget).data("name")],d=new e({model:this.options.model,onHiddenRemove:!0,preselected:c});d.render(),a("body").append(d.$el),d.show()}},{key:"render",value:function(){var d=this;c.View.prototype.render(this,arguments),this.$el.append('<div class="ns_text" style="border: solid 1px #c7c7c7; border-radius: 5px; padding: 5px;"></div>');var e=this.options.model.event.get("next_steps");if(void 0!==e&&null!==e){var f=JSON.parse(e);1===f.version&&a.when(this.mlm._fetchModularAlertsViews()).then(function(){var a=f.data;a=b.escape(a);var c=a.replace(/\n/g,"<br />");c=c.replace(/\[\[action\|([a-zA-Z0-9_]*)\]\]/g,function(a,c){return d.mlm.getAlertNames().indexOf(c)===-1?b.template('<span class="step-action-bad-ref" style="color: #d6563c; cursor: not-allowed;" title="This action is not installed."><%- name %></span>',{name:c}):b.template('<span class="step-action-ref" style="color: #1e93c6; cursor: pointer;" data-name="<%- name %>"><%- name %></span>',{name:c})}),d.$el.find(".ns_text").append(c)})}else this.$el.find(".ns_text").append(b.template('<div class="icon-info-circle ir-icon-info-circle-style" style="display: inline-block;"></div><span> No Next Steps defined.</span>'));return this}}]),g}(c.View);return f});