"use strict";define(["underscore","module","views/Base","sa-threatintelligence/js/components/incident_review/eventsviewer/table/head/TableHead","sa-threatintelligence/js/components/incident_review/eventsviewer/table/body/Master","splunk.util"],function(a,b,c,d,e,f){return c.extend({moduleId:b.id,className:"scrolling-table-wrapper table",initialize:function(){c.prototype.initialize.apply(this,arguments),a.defaults(this.options,{sortableFields:!0}),this.tableId=this.cid+"-table",this.collection.intersectedFields=this.collection.selectedFields.deepClone(),this.tableHeadlabels=this.options.tableHeaderLabels,this.tableHeaderFieldNames=this.options.tableHeaderFieldNames,this.children.head=new d({model:{result:this.model.result,report:this.model.report,searchJob:this.model.searchJob},collection:{selectedRows:this.collection.selectedRows,intersectedFields:this.collection.intersectedFields,selectedFields:this.collection.selectedFields},labels:this.tableHeadlabels,tableHeaderFieldNames:this.tableHeaderFieldNames,backboneEventMediator:this.options.backboneEventMediator,selectableFields:this.options.selectableFields,sortableFields:this.options.sortableFields,allowRowExpand:this.options.allowRowExpand,showWarnings:this.options.showWarnings,isRealTime:this.model.searchJob.entry.content.get("isRealTimeSearch"),fieldFormating:this.options.fieldFormating}),this.children.body=new e({model:{result:this.model.result,summary:this.model.summary,state:this.model.state,searchJob:this.model.searchJob,report:this.model.report,application:this.model.application},collection:{selectedRows:this.collection.selectedRows,eventRenderers:this.collection.eventRenderers,workflowActions:this.collection.workflowActions,notableEventSuppressions:this.collection.notableEventSuppressions,intersectedFields:this.collection.intersectedFields,selectedFields:this.collection.selectedFields},selectableFields:this.options.selectableFields,allowRowExpand:this.options.allowRowExpand,primaryRowFields:this.options.tableHeaderFieldNames,fieldNameMapping:this.options.fieldNameMapping,backboneEventMediator:this.options.backboneEventMediator,filedNameReplacementForActions:this.options.filedNameReplacementForActions,fieldFormating:this.options.fieldFormating})},activate:function(a){return a=a||{},a.startListening=!1,this.active?c.prototype.activate.apply(this,arguments):(this.children.head.updateLabels(this.tableHeadlabels),this.stopListening(),this.startListening(),this.updateIntersectedFields(),c.prototype.activate.call(this,a))},startListening:function(){this.listenTo(this.children.body,"rows:pre-remove",function(){this.$el.css("minHeight",this.$el.height())}),this.listenTo(this.children.body,"rows:added",function(){this.$el.css("minHeight","")}),this.listenTo(this.collection.selectedFields,"reset add remove",function(a,b,c){c||(c=b,b=a,a=void 0),a&&a.get("name")===this.model.report.entry.content.get("display.events.table.sortColumn")&&this.model.report.entry.content.set({"display.events.table.sortColumn":"","display.events.table.sortDirection":""}),this.updateIntersectedFields(),this.children.modalize.debouncedCleanup()})},deactivate:function(a){return this.active?(c.prototype.deactivate.apply(this,arguments),this):c.prototype.deactivate.apply(this,arguments)},updateIntersectedFields:function(){var b=[];this.model.result.results.length&&(a.each(a(this.collection.selectedFields.pluck("name")).intersection(this.model.result.fields.pluck("name")),function(a){b.push({name:a})}),this.collection.intersectedFields.reset(b))},updateTableHead:function(){a.defer(function(){this.updateContainerHeight()}.bind(this))},updateContainerHeight:function(a){a?this.$("> .vertical-scrolling-table-wrapper").css("height",a):this.$("> .vertical-scrolling-table-wrapper").css("max-height",$(window).height()-this.$el.offset().top)},render:function(){return this.$el.html(this.compiledTemplate({tableId:this.tableId})),this.children.head.render().appendTo(this.$("#"+this.tableId)),this.children.body.render().appendTo(this.$("#"+this.tableId)),this},reflow:function(){return this.updateTableHead(),this},template:'\t\t\t\t<table class="table table-chrome table-row-expanding events-results events-results-table" id="<%- tableId %>"></table>\t\t\t\t\t'})});