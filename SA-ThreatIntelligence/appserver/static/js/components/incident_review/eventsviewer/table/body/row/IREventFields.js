"use strict";require.config({paths:{"sa-utils":"../app/SA-Utils","sa-threatintelligence":"../app/SA-ThreatIntelligence"}}),define(["jquery","underscore","backbone","module","splunkjs/mvc","sa-threatintelligence/js/components/incident_review/eventsviewer/table/body/row/IRBaseFields","splunk.util","css!sa-threatintelligence/js/components/incident_review/eventsviewer/css/IREventViewer.css","sa-threatintelligence/js/components/incident_review/eventsviewer/IREventViewerUtils","sa-utils/js/util/SearchOptimizer","sa-threatintelligence/js/views/AdaptiveResponseActionListView","sa-threatintelligence/js/components/response/NextStepsView"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.Collection.extend({url:Splunk.util.make_url("/splunkd/__raw/servicesNS/nobody/SA-Utils/storage/collections/data/user_realnames?fields=user,realname")}),n='<table class="ir-table-no-row-border enforce-table-width">\t\t\t\t\t<tbody> \t\t\t\t\t<tr><td><%=data.compiledDescriptionTemplate({m:data.m, _:data._, getFieldValue:data.getFieldValue, fieldFormating:data.fieldFormating}, {variable:"data"})%></td></tr>\t\t\t\t\t<tr><td><%=data.compiledAdditionFieldsTemplate({m:data.m, _:data._, r:data.r,  fields:data.fields, displayFields:data.displayFields, getFieldValue:data.getFieldValue, fieldFormating:data.fieldFormating }, {variable:"data"})%></td></tr>\t\t\t\t\t</tbody> \t\t\t\t</table>',o=b.template(n,null,{variable:"data"}),p='\t\t\t<%if(data.m.has("rule_description")) { %>\t\t\t\t<table class="ir-table-no-row-border">\t\t\t\t\t<tbody> \t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class="ir-header">Description:</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr> \t\t\t\t\t\t\t<% var fieldlist = data.m.get("rule_description") %>\t\t\t\t\t\t\t<% if(fieldlist && fieldlist.length > 0) { %>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<%  data._(fieldlist).each(function(mv_field, j) { %>\t\t\t\t\t\t\t\t\t<%- data.getFieldValue(data.m, mv_field, "rule_description") %>\t\t\t\t\t\t\t\t<% }); %> \t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<% } %> \t\t\t\t\t\t</tr> \t\t\t\t\t</tbody> \t\t\t\t</table> \t\t\t<%}%>',q=b.template(p,null,{variable:"data"}),r='\t\t\t\t<% var gov = data.m.get("governance") %>\t\t\t\t<% var cont = data.m.get("control") %>\t\t\t\t<% if ( gov && cont ) { %>\t\t\t\t\t<% var gov_str = data.getFieldValue(data.m, gov.toString(), "governance") %>\t\t\t\t\t<% var cont_str = data.getFieldValue(data.m, cont.toString(), "control") %>\t\t\t\t\t<% if ( gov_str && cont_str ) { %>\t\t\t\t\t<% var gov_toks = gov_str.split( "," ) %>\t\t\t\t\t<% var cont_toks = cont_str.split( "," ) %>\t\t\t\t\t<% if ( gov_toks && cont_toks ) { %>\t\t\t\t\t\t<% if (gov_toks.length > 0) { %>\t\t\t\t\t\t\t<tr><td><table class="ir-table-gov-no-border">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td class="ir-header">Compliance</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t<table class="ir-table-gov-row-border">\t\t\t\t\t\t\t\t\t\t\t<thead>\t\t\t\t\t\t\t\t\t\t\t\t<tr class="ir-gov-head">\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="ir-gov-governance">Governance</td>\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="ir-gov-control">Control</td>\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t</thead> \t\t\t\t\t\t\t\t\t\t\t<tbody> \t\t\t\t\t\t\t\t\t\t\t\t<% for ( var i = 0; i < gov_toks.length; i++ ) { %>\t\t\t\t\t\t\t\t\t\t\t\t<tr class="ir-gov">\t\t\t\t\t\t\t\t\t\t\t\t\t<td><%-gov_toks[i]%></td>\t\t\t\t\t\t\t\t\t\t\t\t\t<td><%-cont_toks[i]%></td>\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<% } %>\t\t\t\t\t\t\t\t\t\t\t</tbody> \t\t\t\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t</table></td></tr>\t\t\t\t\t\t<% } %>\t\t\t\t\t<% } %>\t\t\t\t\t<% } %>\t\t\t\t<% } %>',s=b.template(r,null,{variable:"data"}),t='\t\t\t\t<table class="ir-table-no-row-border enforce-table-width">\t\t\t\t\t<thead>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class="ir-header">Additional Fields</td>\t\t\t\t\t\t\t<td class="ir-header">Value</td>\t\t\t\t\t\t\t<td class="ir-header" width="40px">Action</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</thead> \t\t\t\t\t<tbody> \t\t\t\t\t\t<%  data._(data.fields).each(function(field, i) { %>\t\t\t\t\t\t\t<% if(data.displayFields.hasOwnProperty(field)) { %>\t\t\t\t\t\t\t\t<% var fieldlist = data.m.get(field) %>\t\t\t\t\t\t\t\t<% if(fieldlist && fieldlist.length > 0) { %>\t\t\t\t\t\t\t\t\t<% data._(fieldlist).each(function(mv_field, j) { %>\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t\t\t<% if(j==0) { %> \t\t\t\t\t\t\t\t\t\t\t\t<td rowspan="<%-fieldlist.length %>" class="ir-field-key wrap-cell"> <%- data.displayFields[field] %> </td>\t\t\t\t\t\t\t\t\t\t\t\t<td class="ir-field-value wrap-cell"> <%- data.getFieldValue(data.m, mv_field, field) %>\t\t\t\t\t\t\t\t\t\t\t<% } else { %>\t\t\t\t\t\t\t\t\t\t\t\t<td class="ir-field-value wrap-cell ir-no-left-padding"> <%- data.getFieldValue(data.m, mv_field, field) %>\t\t\t\t\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t\t\t\t\t\t<% var tags = data.r.getTags(field, mv_field); %>\t\t\t\t\t\t\t\t\t\t\t<% if (tags.length) { %>\t\t\t\t\t\t\t\t\t\t\t\t(<% data._(tags).each(function(tag, idx){ %><span style="color:#999;" data-tagged-field-name="tag::<%- field %>" class="ir-tag"><%- tag %><%if(idx!=tags.length-1){%> <%}%></span><% }); %>)\t\t\t\t\t\t\t\t\t\t\t<% } %>\t\t\t\t\t\t\t\t\t\t\t<% if (data.m.get(field + "_risk_score")) { %>\t\t\t\t\t\t\t\t\t\t\t\t<div class="ir-risk-score-container">\t\t\t\t\t\t\t\t\t\t\t\t\t<a data-toggle="tooltip" data-placement="top" data-original-title="Risk Score" href="<%= Splunk.util.make_full_url("/app/SplunkEnterpriseSecuritySuite/risk_analysis", {"form.risk_object_form": data.getFieldValue(data.m, mv_field, field), "form.risk_object_type": data.m.get(field + "_risk_object_type")}) %>" target="_blank">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="ir-risk-score"><%- data.m.get(field + "_risk_score") %></div>\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<% } %>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td  class="actions popdown">\t\t\t\t\t\t\t\t\t\t\t\t<a class="ir-popdown-toggle ir-field-actions ir-btn-pill" data-field-name="<%- field %>" data-field-value="<%- data.getFieldValue(data.m, mv_field, field) %>">\t\t\t\t\t\t\t\t\t\t\t\t<span class="caret"></span>\t\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t</tr> \t\t\t\t\t\t\t\t\t<% }); %> \t\t\t\t\t\t\t\t<% } %> \t\t\t\t\t\t\t<% } %>\t\t\t\t\t\t<% }); %>\t\t\t\t\t</tbody> \t\t\t\t</table>',u=b.template(t,null,{variable:"data"}),v='\t\t\t\t<table class="ir-table-no-row-border">\t\t\t\t\t<tbody> \t\t\t\t\t\t<%=data.compiledEventSourceTemplate({m:data.m, r:data.r, _:data._, getFieldValue: data.getFieldValue, appName: data.appName, SplunkUtil: data.SplunkUtil, fieldFormating:data.fieldFormating}, {variable : "data"} )%>\t\t\t\t\t\t<%=data.compiledGovernanceTemplate({m:data.m, _:data._, getFieldValue:data.getFieldValue, fieldFormating:data.fieldFormating}, {variable:"data"})%>\t\t\t\t\t\t<%=data.compiledEventEditHistoryTemplate({m:data.m, r:data.r, _:data._, getFieldValue: data.getFieldValue, appName: data.appName, SplunkUtil: data.SplunkUtil, fieldFormating:data.fieldFormating}, {variable : "data"} )%>\t\t\t\t\t\t<%=data.compiledEventDrillDownTemplate({m:data.m, r:data.r, _:data._, getFieldValue: data.getFieldValue, appName: data.appName, SplunkUtil: data.SplunkUtil, auto_pause: data.auto_pause, fieldFormating:data.fieldFormating, SearchOptimizer: data.SearchOptimizer}, {variable : "data"} )%>\t\t\t\t\t\t<%=data.compiledEventLinkTemplate({m:data.m, r:data.r, _:data._, getFieldValue: data.getFieldValue, appName: data.appName, SplunkUtil: data.SplunkUtil, fieldFormating:data.fieldFormating}, {variable : "data"} )%>\t\t\t\t\t\t<%=data.compiledOrgRawTemplate({m:data.m, r:data.r, _:data._, getFieldValue: data.getFieldValue, appName: data.appName, SplunkUtil: data.SplunkUtil, fieldFormating:data.fieldFormating}, {variable : "data"} )%>                        <tr>                            <td><div class="ir-event-module"><div class="ir-event-module-title ir-header">Adaptive Responses:<a href="#" id="refresh-adaptive-responses" class="btn-pill" data-toggle="tooltip" title="Refresh" data-original-title="Refresh"><i class="icon-rotate"></i></a></div><div class="adaptive-response-list"></div></div></td>                        </tr>                        <tr>                            <td><div class="ir-event-module"><div class="ir-event-module-title ir-header">Next Steps:</div><div class="adaptive-response-next-steps"></div></div></td>                        </tr>\t\t\t\t\t</tbody> \t\t\t\t</table>',w=b.template(v,null,{variable:"data"}),x='\t\t\t<%if(data.m.has("source")) { %>\t\t\t\t<tr><td><table class="ir-table-no-row-border">\t\t\t\t\t<tbody> \t\t\t\t\t\t<tr> <td class="ir-header">Correlation Search:</td></tr>\t\t\t\t\t\t<tr> \t\t\t\t\t\t\t<% var source = data.getFieldValue(data.m, data.m.get("source").toString(), "source") %>\t\t\t\t\t\t\t<% if(source) { %>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<%if (source !== "Manual Notable Event - Rule") { %>\t\t\t\t\t\t\t\t\t\t<a href="<%= Splunk.util.make_full_url("app/" + encodeURIComponent(data.appName) + "/correlation_search_edit", {search: source}) %>" target="_bank"><%-source%></a> \t\t\t\t\t\t\t\t\t<% } else { %>\t\t\t\t\t\t\t\t\t\t<%- "None (manually created)" %> \t\t\t\t\t\t\t\t\t<% } %> \t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<% } %> \t\t\t\t\t\t</tr> \t\t\t\t\t</tbody> \t\t\t\t</table></td></tr> \t\t\t<%}%>',y=b.template(x,null,{variable:"data"}),z='\t\t\t<%if(data.m.has("rule_id") && data.m.get("rule_title")) { %>\t\t\t\t<tr><td><table class="history ir-table-no-row-border">\t\t\t\t\t<tbody> \t\t\t\t\t\t<tr> <td class="ir-header">History:</td></tr>\t\t\t\t\t\t<% var ruleid = data.getFieldValue(data.m, data.m.get("rule_id").toString(), "rule_id") %>\t\t\t\t\t\t<% var ruletitle = data.getFieldValue(data.m, data.m.get("rule_title").toString(), "rule_title") %> \t\t\t\t\t\t<% if (data.m.has("comment")) { %>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td style="padding-top: 5px; padding-bottom: 5px; font-family: Consolas, Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace, serif; font-size: 11px;">\t\t\t\t\t\t\t\t\t<div style="padding: 5px; border: 1px solid #CCCCCC;"> \t\t\t\t\t\t\t\t\t\t<div class="reviewer" style="float: right;"></div> \t\t\t\t\t\t\t\t\t\t<div class="reviewTime" style="padding-bottom: 10px;"></div> \t\t\t\t\t\t\t\t\t\t<span class="comment"></span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</td> \t\t\t\t\t\t\t</tr> \t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td style="padding-top: 5px; padding-bottom: 5px;">\t\t\t\t\t\t\t\t\t<div class="pull-right"> \t\t\t\t\t\t\t\t\t\t<a class="ir-row-prev-comment" href="#">Previous <i class="icon-chevron-right"></i></a>\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t<div class="pull-left"> \t\t\t\t\t\t\t\t\t\t<a class="ir-row-next-comment" href="#"><i class="icon-chevron-left"></i> Next</a> \t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t</td> \t\t\t\t\t\t\t</tr> \t\t\t\t\t\t<% } %> \t\t\t\t\t\t<tr> \t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<% var query = "|`incident_review` | search rule_id=\\""+ ruleid +"\\" | rename status_label as status | fields _time, rule_id, reviewer, urgency, status, owner, comment" %>\t\t\t\t\t\t\t\t<a href="<%= Splunk.util.make_full_url("app/" + encodeURIComponent(data.appName) + "/flashtimeline", {q : query}) %>" target="_blank">View all review activity for this Notable Event </a>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr> \t\t\t\t\t</tbody> \t\t\t\t</table></td></tr> \t\t\t<%}%>',A=b.template(z,null,{variable:"data"}),B='\t\t\t<%if(data.m.has("drilldown_name") && data.m.get("drilldown_search")) { %>\t\t\t\t<% \tvar drilldownName = data.getFieldValue(data.m,  data.m.get("drilldown_name").toString(), "drilldown_name")  %> \t\t\t\t<%\tvar drilldownSearch = data.getFieldValue(data.m,  data.m.get("drilldown_search").toString(), "drilldown_search") %> \t\t\t\t<%\tdrilldownSearch = drilldownSearch.replace("\\"", "\\"")%> \t\t\t\t<%\tif (!drilldownSearch.charAt(0) === "|") { %> \t\t\t\t<%\t\tdrilldownSearch = "search " +  drilldownSearch%> \t\t\t\t<%\t}%> \t\t\t\t<% var earliest = data.m.has("drilldown_earliest") && parseInt(data.m.get("drilldown_earliest").toString(), 10) %>\t\t\t\t<% var latest = data.m.has("drilldown_latest") && parseInt(data.m.get("drilldown_latest").toString(), 10) %>\t\t\t\t<% var queryParams%>\t\t\t\t<% if((earliest || earliest === 0) && latest && latest >= earliest) { %> \t\t\t\t<%\t\tqueryParams = {q: drilldownSearch, latest:latest, earliest:earliest } %>\t\t\t\t<%} else { %>\t\t\t\t<%\t\tqueryParams = {q: drilldownSearch}%>\t\t\t\t<%}%>\t\t\t\t<%\tif (drilldownSearch.search(/^\\s*\\|\\s*`?datamodel/) !== -1) {%>\t\t\t\t<%\t\tqueryParams.auto_pause = data.auto_pause; %>\t\t\t\t<%}%>\t\t\t\t<%  queryParams.q = data.SearchOptimizer.optimize(queryParams.q) %>\t\t\t\t<tr><td><table class="drilldown ir-table-no-row-border"> \t\t\t\t\t<tbody> \t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class="ir-header">Contributing Events:</td>\t\t\t\t\t\t</tr> \t\t\t\t\t\t<tr> \t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<a href="<%= Splunk.util.make_full_url("app/" + encodeURIComponent(data.appName) +"/flashtimeline", queryParams) %>" target="_blank"><%-drilldownName%></a>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</tbody>\t\t\t\t</table></td></tr>\t\t\t<%}%>',C=b.template(B,null,{variable:"data"}),D='\t\t\t\t<%if(data.m.has("drilldown_name") && data.m.get("drilldown_url")) { %>\t\t\t\t\t<% \tvar drilldownName = data.getFieldValue(data.m, data.m.get("drilldown_name").toString(), "drilldown_name")  %> \t\t\t\t\t<%\tvar drilldownUrl = data.getFieldValue(data.m,  data.m.get("drilldown_url").toString(), "drilldown_url") %> \t\t\t\t\t<tr><td><table class="drilldown ir-table-no-row-border"> \t\t\t\t\t\t<tbody> \t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="ir-header">More details:</td>\t\t\t\t\t\t\t</tr> \t\t\t\t\t\t\t<tr> \t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<a href="<%= encodeURI(drilldownUrl) %>" target="_blank"><%-drilldownName%></a>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tbody>\t\t\t\t\t</table></td></tr>\t\t\t\t<%}%>',E=b.template(D,null,{variable:"data"}),F='\t\t\t<% var orgRaw = data.m.get("orig_raw")%>\t\t\t<% if (orgRaw && (data.m.has("orig_event_hash") || data.m.has("orig_cd")) ) {%> \t\t\t\t<tr><td><table class="orig_raw ir-table-no-row-border"> \t\t\t\t\t<tbody> \t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class="ir-header">Original Event:</td>\t\t\t\t\t\t</tr> \t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<%  var value = orgRaw.toString(); \t\t\t\t\t\t\t\t\tvar lines = value.split("\\n"); \t\t\t\t\t\t\t\t\tvar limit = Math.min(10, lines.length); \t\t\t\t\t\t\t\t%>\t\t\t\t\t\t\t\t<div class="event ir-orig-raw-field">\t\t\t\t\t\t\t\t\t<% for(var index=0; index < limit; index++) { %> \t\t\t\t\t\t\t\t\t\t<% if (index==9 ||  index==lines.length-1) { %> \t\t\t\t\t\t\t\t\t\t\t<%-lines[index]%> \t\t\t\t\t\t\t\t\t\t<% } else { %>\t\t\t\t\t\t\t\t\t\t\t<%-lines[index]%> <br/> \t\t\t\t\t\t\t\t\t\t<% } %> \t\t\t\t\t\t\t\t\t<% } %>\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t<% if(lines.length > 10 ) { %>\t\t\t\t\t\t\t\t\t<% var id = Math.floor(Math.random() * 100000000); %> \t\t\t\t\t\t\t\t\t<div style="display:none;" id="<%- id %>" class="event ir-orig-raw-field"> \t\t\t\t\t\t\t\t\t\t<% for(var index=10; index < lines.length; index++) { %> \t\t\t\t\t\t\t\t\t\t\t<%-lines[index]%> <br/>\t\t\t\t\t\t\t\t\t\t<% }%>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<a onclick="$(\'#<%- id %>\').toggle();$(\'#show_<%- id %>\').toggle(); $(\'#hide_<%- id %>\').toggle();return false;">\t\t\t\t\t\t\t\t\t\t<span id="show_<%- id %>">Show all <%- lines.length %> lines</span> \t\t\t\t\t\t\t\t\t\t<span style="display: none;" id="hide_<%- id %>">Collapse back to 10 lines</span>\t\t\t\t\t\t\t\t\t</a> \t\t\t\t\t\t\t\t<%}%> \t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<%if(data.m.has("orig_event_hash") || data.m.has("orig_cd")) { %>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<%  var origSearch;\t\t\t\t\t\t\t\t\t    var origEventSearch = "*";\t\t\t\t\t\t\t\t\t    var origReportSearch = " | `get_event_id`";\t\t\t\t\t\t\t\t\t\tif(data.m.has("orig_time") ) { origEventSearch = origEventSearch + " _time=" + data.getFieldValue(data.m, data.m.get("orig_time").toString(), "orig_time"); }\t\t\t\t\t\t\t\t\t\tif(data.m.has("orig_index") ) { origEventSearch = origEventSearch + " index=" + data.getFieldValue(data.m, data.m.get("orig_index").toString(), "orig_index"); }\t\t\t\t\t\t\t\t\t\tif(data.m.has("orig_indexer_guid") ) { origReportSearch = origReportSearch + " | search indexer_guid=" + data.getFieldValue(data.m, data.m.get("orig_indexer_guid").toString(), "orig_indexer_guid"); }\t\t\t\t\t\t\t\t\t    if(data.m.has("orig_event_hash") ) { origReportSearch = origReportSearch + " | search event_hash=" + data.getFieldValue(data.m, data.m.get("orig_event_hash").toString(), "orig_event_hash"); }\t\t\t\t\t\t\t\t\t\tif(data.m.has("orig_cd") ) { origReportSearch = origReportSearch + " | search _cd=" + data.getFieldValue(data.m, data.m.get("orig_cd").toString(), "orig_cd"); }\t\t\t\t\t\t\t\t\t\torigSearch = origEventSearch + origReportSearch + " | head 1";\t\t\t\t\t\t\t\t\t%>\t\t\t\t\t\t\t\t\t<% var query = data.SplunkUtil.addLeadingSearchCommand(origSearch) %>\t\t\t\t\t\t\t\t\t<a href="<%= Splunk.util.make_full_url("app/" + encodeURIComponent(data.appName) + "/flashtimeline", {q: query}) %>" target="_blank">View original event</a>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t<%}%>\t\t\t\t\t</tbody> \t\t\t\t</table></td></tr>\t\t\t<%}%>',G=b.template(F,null,{variable:"data"}),H='\t\t\t<table class="ir-table-no-row-border" style="padding-left: 10px;"> \t\t\t\t<tbody>\t\t\t\t\t<tr> <td class="ir-header">Event Details:</td></tr>\t\t\t\t\t<tr> \t\t\t\t\t\t<% var event_id = data.m.get("event_id")?data.m.get("event_id").toString():"" %>\t\t\t\t\t\t<td class="ir-field-key">event_id</td> \t\t\t\t\t\t<td class="ir-field-value"><%-data.getFieldValue(data.m, event_id, "event_id")%> </td> \t\t\t\t\t\t<td> \t\t\t\t\t\t\t<a class="ir-popdown-toggle ir-field-actions ir-btn-pill" data-field-name="event_id" data-field-value="<%- data.getFieldValue(data.m, event_id, "event_id") %>">\t\t\t\t\t\t\t\t<span class="caret"></span>\t\t\t\t\t\t\t</a>\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t<tr>\t\t\t\t\t\t<% var event_hash = data.m.get("event_hash")?data.m.get("event_hash").toString():"" %>\t\t\t\t\t\t<td class="ir-field-key">event_hash</td>\t\t\t\t\t\t<td class="ir-field-value"><%-data.getFieldValue(data.m, event_hash, "event_hash")%> </td>\t\t\t\t\t\t<td> \t\t\t\t\t\t\t<a class="ir-popdown-toggle ir-field-actions ir-btn-pill" data-field-name="event_hash" data-field-value="<%- data.getFieldValue(data.m, event_hash, "event_hash") %>">\t\t\t\t\t\t\t\t<span class="caret"></span>\t\t\t\t\t\t\t</a>\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t<% var eventtype = data.m.get("eventtype") %>\t\t\t\t\t<% if(eventtype && eventtype.length > 0) { %>\t\t\t\t\t\t<% data._(eventtype).each(function(mv_field, j) { %>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<% if(j===0) { %> \t\t\t\t\t\t\t\t\t<td rowspan="<%-eventtype.length%>" class="ir-field-key">eventtype</td> \t\t\t\t\t\t\t\t\t<td class="ir-field-value"> <%- data.getFieldValue(data.m, mv_field, "eventtype") %>\t\t\t\t\t\t\t\t<% } else { %>\t\t\t\t\t\t\t\t\t<td class="ir-field-value ir-no-left-padding"> <%- data.getFieldValue(data.m, mv_field, "eventtype") %>\t\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t\t\t<% var tags = data.r.getTags(eventtype, mv_field); %>\t\t\t\t\t\t\t\t<% if (tags.length) { %>\t\t\t\t\t\t\t\t\t\t(<% data._(tags).each(function(tag, idx){ %><span style="color:#999;" data-tagged-field-name="tag::<%- eventtype %>" class="ir-tag"><%- tag %><%if(idx!=tags.length-1){%> <%}%></span><% }); %>)\t\t\t\t\t\t\t\t<% } %>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td> \t\t\t\t\t\t\t\t\t<a class="ir-popdown-toggle ir-field-actions ir-btn-pill" data-field-name="eventtype" data-field-value="<%- data.getFieldValue(data.m, mv_field, "eventtype") %>">\t\t\t\t\t\t\t\t\t\t<span class="caret"></span>\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t<%})%>\t\t\t\t\t<% } %>\t\t\t\t</tbody> \t\t\t</table> ',I=b.template(H,null,{variable:"data"});return f.extend({moduleId:d.id,initialize:function(){f.prototype.initialize.apply(this,arguments),this.swappingKey=this.options.swappingKey,this.showAllLines=this.options.showAllLines,this.rowExpanded="r"+this.options.idx,this.fieldNameMapping=this.options.fieldNameMapping,this.commentNumber=0},events:b.extend(f.prototype.events,{"click #refresh-adaptive-responses":"refreshAdaptiveResponses"}),startListening:function(){f.prototype.startListening.apply(this,arguments),this.listenTo(this.model.event,"change",function(a,b){b.swap&&(this.isSwapping=!1),this.render()}),this.listenTo(this.model.result,"tags-updated",this.render),this.listenTo(this.model.event,"failed-swap",function(){this.$(".event-fields-loading").text(b("We were unable to provide the correct event").t())}),this.listenTo(this.model.state,"change:"+this.showAllLines,function(){this.isSwapping=!0}),this.listenTo(this.model.result,this.swappingKey,function(){this.isSwapping=!0}),this.listenTo(this.model.state,"change:"+this.rowExpanded,function(a,b,c){b&&this.eventExpanded()}.bind(this))},activate:function(a){return this.active?f.prototype.activate.apply(this,arguments):(this.isSwapping=!0,f.prototype.activate.apply(this,arguments))},setMaxWidth:function(){if(!this.el.innerHTML||!this.$el.is(":visible"))return!1;var b=a("#"+this.cid+"-styles");b&&b.remove();var c=this.$el.closest("table").parent(),d=c.width(),e=c.offset().left-c.scrollLeft(),f=20,g=this.$el.offset().left,h=d-(g-e)-f,i=(h>500?h:500)+"px";return this.$("table").css("maxWidth",i),!0},reflow:function(){this.setMaxWidth()},activateTooltip:function(){return this.$('[data-toggle="tooltip"]').tooltip(),this},eventExpanded:function(){var b=null,c=null;if(void 0!==this.model.event.get("orig_sid")&&void 0!==this.model.event.get("orig_rid")?(b=this.model.event.get("orig_rid")[0],c=this.model.event.get("orig_sid")[0]):void 0!==this.model.event.get("sid")&&void 0!==this.model.event.get("rid")&&(b=this.model.event.get("rid")[0],c=this.model.event.get("sid")[0]),null!==b&&null!==c){var d=(new k({el:a(".adaptive-response-list",this.$el),sid:c,rid:b}),new l({el:a(".adaptive-response-next-steps",this.$el),model:this.model}));d.render()}},refreshAdaptiveResponses:function(){var a=null,b=null;if(void 0!==this.model.event.get("orig_sid")&&void 0!==this.model.event.get("orig_rid")?(a=this.model.event.get("orig_rid")[0],b=this.model.event.get("orig_sid")[0]):void 0!==this.model.event.get("sid")&&void 0!==this.model.event.get("rid")&&(a=this.model.event.get("rid")[0],b=this.model.event.get("sid")[0]),null!==a&&null!==b){var d="refresh-action-response:"+a+":"+b;c.trigger(d)}return!1},doRender:function(){var a=this;return j.populateConfigs().then(function(){var c=e.Components.get("submitted").get("auto_pause")||0;a.$el.html(a.compiledTemplate({compiledDescriptionAdditionDetailsTemplate:o,compiledDescriptionTemplate:q,compiledAdditionFieldsTemplate:u,compiledEventSourceTemplate:y,compiledGovernanceTemplate:s,compiledEventEditHistoryTemplate:A,compiledOtherInformationTemplate:w,compiledEventDrillDownTemplate:C,compiledEventMetaInfoTemplate:I,compiledOrgRawTemplate:G,compiledEventLinkTemplate:E,fields:a.model.event.strip(),displayFields:a.fieldNameMapping||{},getFieldValue:i.getFieldValue,r:a.model.result,m:a.model.event,isSwapping:!1,_:b,auto_pause:c,appName:a.model.application.get("app"),SplunkUtil:g,fieldFormating:a.options.fieldFormating,SearchOptimizer:j})),a.setRealnames(m.realnames),a.setMaxWidth(),a.goToComment(0),a.showHideNextPrevLinks()}),this},render:function(){if("undefined"!=typeof m.realnames)return this.doRender().activateTooltip();var a=new m;a.fetch({success:function(a){for(var b={},c=0;c<a.length;c++)void 0!==a.models[c].attributes.realname?b[a.models[c].attributes.user]=a.models[c].attributes.realname:b[a.models[c].attributes.user]=a.models[c].attributes.user;m.realnames=b}.bind(this),complete:function(){return this.doRender().activateTooltip()}.bind(this)})},template:'\n\t\t\t<% if (!isSwapping) { %>\n\t\t\t<table class="table-condensed ir-table-no-row-border table-secondary-row">\n\t\t\t\t<tbody> \n\t\t\t\t\t<tr> \n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<%= compiledDescriptionAdditionDetailsTemplate({\n\t\t\t\t\t\t\t\t\tm:m, \n\t\t\t\t\t\t\t\t\tr:r, \n\t\t\t\t\t\t\t\t\t_:_, \n\t\t\t\t\t\t\t\t\tfields:fields, \n\t\t\t\t\t\t\t\t\tdisplayFields:displayFields,\n\t\t\t\t\t\t\t\t\tcompiledDescriptionTemplate: compiledDescriptionTemplate,\n\t\t\t\t\t\t\t\t\tcompiledAdditionFieldsTemplate:compiledAdditionFieldsTemplate, \n\t\t\t\t\t\t\t\t\tgetFieldValue: getFieldValue, \n\t\t\t\t\t\t\t\t\tfieldFormating:fieldFormating\n\t\t\t\t\t\t\t\t}, {variable : "data"})\n\t\t\t\t\t\t\t%>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td style="vertical-align: top;">\n\t\t\t\t\t\t\t<%= compiledOtherInformationTemplate({\n\t\t\t\t\t\t\t\t\tm:m, \n\t\t\t\t\t\t\t\t\tr:r, \n\t\t\t\t\t\t\t\t\t_:_, \n\t\t\t\t\t\t\t\t\tgetFieldValue: getFieldValue, \n\t\t\t\t\t\t\t\t\tappName: appName, \n\t\t\t\t\t\t\t\t\tSplunkUtil: SplunkUtil, \n\t\t\t\t\t\t\t\t\tauto_pause: auto_pause, \n\t\t\t\t\t\t\t\t\tcompiledEventSourceTemplate:compiledEventSourceTemplate, \n\t\t\t\t\t\t\t\t\tcompiledGovernanceTemplate:compiledGovernanceTemplate, \n\t\t\t\t\t\t\t\t\tcompiledEventEditHistoryTemplate:compiledEventEditHistoryTemplate, \n\t\t\t\t\t\t\t\t\tcompiledEventDrillDownTemplate:compiledEventDrillDownTemplate, \n\t\t\t\t\t\t\t\t\tcompiledOrgRawTemplate:compiledOrgRawTemplate, \n\t\t\t\t\t\t\t\t\tcompiledEventLinkTemplate:compiledEventLinkTemplate, \n\t\t\t\t\t\t\t\t\tfieldFormating:fieldFormating,\n\t\t\t\t\t\t\t\t\tSearchOptimizer: SearchOptimizer\n\t\t\t\t\t\t\t\t}, {variable : "data"})\n\t\t\t\t\t\t\t%>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr> \n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=2>\n\t\t\t\t\t\t\t<table class="ir-table-no-row-border">\n\t\t\t\t\t\t\t<tbody> \n\t\t\t\t\t\t\t\t<tr><td>\n\t\t\t\t\t\t\t\t\t<%=compiledEventMetaInfoTemplate({m:m, getFieldValue:getFieldValue, r:r,  _:_, fieldFormating:fieldFormating }, {variable : "data"})%>\n\t\t\t\t\t\t\t\t</td></tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody> \n\t\t\t</table> \n\t\t\t<% } else { %>\n\t\t\t\t<div class="event-fields-loading"><%- _("Loading...").t() %></div>\n\t\t\t<% } %>\n\t\t'})});