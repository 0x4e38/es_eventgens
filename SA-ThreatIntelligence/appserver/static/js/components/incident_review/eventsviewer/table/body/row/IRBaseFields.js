"use strict";define(["jquery","underscore","backbone","splunkjs/mvc","splunkjs/mvc/searchmanager","splunkjs/mvc/utils","module","keyboard/SearchModifier","views/Base","views/shared/eventsviewer/shared/WorkflowActions","views/shared/WaitSpinner"],function(a,b,c,d,e,f,g,h,i,j,k){return i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.rowExpanded="r"+this.options.idx,this.keyboardSearchModifier=new h,this.realnames=null,a.expr[":"].caseInsensitiveContains=function(b,c,d){return a(b).text().toUpperCase().indexOf(d[3].toUpperCase())>=0}},startListening:function(){this.listenTo(this.model.event,"change",this.render)},events:{"click .ir-field-actions":function(a){a.preventDefault()},"mousedown .ir-field-actions":"openFieldActions","keydown .ir-field-actions":function(a){13===a.keyCode&&this.openFieldActions(a)},"click .ir-row-next-comment":function(a){this.goToNextComment(),a.preventDefault()},"click .ir-row-prev-comment":function(a){this.goToPrevComment(),a.preventDefault()}},showHideNextPrevLinks:function(){return void 0===this.model.event.get("comment")?(a(".ir-row-next-comment",this.$el).hide(),void a(".ir-row-prev-comment",this.$el).hide()):(0===this.commentNumber?a(".ir-row-next-comment",this.$el).hide():a(".ir-row-next-comment",this.$el).show(),void(this.commentNumber+1>=this.model.event.get("comment").length?a(".ir-row-prev-comment",this.$el).hide():a(".ir-row-prev-comment",this.$el).show()))},formatDate:function(a){var b=new Date(1e3*parseFloat(a)),c={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"};return b.getFullYear()+" "+c[b.getMonth()]+" "+b.getDate()+" "+b.toLocaleTimeString()},setRealnames:function(a){this.realnames=a},getComment:function(a,b){if("undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=this.model.event),0!==b.get("comment").length){var c=null;this.realnames&&(c=this.realnames[b.get("reviewer")[a].toString()]),c||(c=b.get("reviewer")[a].toString());var d={comment:b.get("comment")[a].toString(),review_time:this.formatDate(b.get("review_time")[a].toString()),reviewer:c};return d}},convertEndlinesToBR:function(a){return b.escape(a).replace(/\n/g,"<br/>")},goToComment:function(b){if(this.model.event.get("comment")){var c=this.commentNumber+b;(c<0||c>=this.model.event.get("comment").length)&&(c=0),this.commentNumber=c,this.showHideNextPrevLinks();var d=this.getComment(this.commentNumber,this.model.events);a(".comment",this.$el).html(this.convertEndlinesToBR(d.comment)),a(".reviewer",this.$el).text(d.reviewer),a(".reviewTime",this.$el).text(d.review_time)}},goToNextComment:function(){this.goToComment(-1)},goToPrevComment:function(){this.goToComment(1)},openFieldActions:function(b){var c=a(b.currentTarget),d=c.attr("data-field-name"),e=c.attr("data-field-value");return!(!this.children.fieldActions||!this.children.fieldActions.shown||(this.children.fieldActions.hide(),this.lastMenu!==d+"-field-actions"))||(this.children.fieldActions=new j({model:this.model,collection:this.collection.workflowActions,field:{name:d,value:e},mode:"menu",fieldName:d,fieldValue:e}),this.lastMenu=d+"-field-actions",this.children.fieldActions.render().appendTo(a("body")).show(c),b.preventDefault(),!1)}})});