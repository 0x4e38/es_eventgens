"use strict";define(["jquery","underscore","backbone","module","views/Base","css!./css/EventFields.css"],function(a,b,c,d,e){function f(a){return"_"===a.charAt(0)||"source"===a||"index"===a}return e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.filter=""},startListening:function(){this.listenTo(this.model.event,"change",function(){this.render()}),this.listenTo(this.collection.selectedFields,"reset",function(a,b){this.render()}),this.listenTo(this.collection.selectedFields,"add remove",function(a,b,c){this.render(),a&&this.$('.checkbox[data-field-name="'+a.get("name")+'"] > a')[0].focus()})},events:{"click a.f-v":function(a){a.preventDefault()},"click a.show-field":function(b){var c=a(b.currentTarget),d=a.trim(c.closest("td").siblings(".field-key").text());this.collection.selectedFields.push({name:d}),b.preventDefault()},"click a.hide-field":function(b){var c=a(b.currentTarget),d=a.trim(c.closest("td").siblings(".field-key").text());this.collection.selectedFields.remove(this.collection.selectedFields.find(function(a){return a.get("name")===d},this)),b.preventDefault()},"click a.btn.disabled":function(a){a.preventDefault()}},render:function(){var a=this.filter,c=b.chain(this.model.event.attributes).keys().filter(function(b){return!f(b)&&b.search(a)!==-1}).value(),d=b.filter(this.collection.selectedFields.pluck("name"),function(a){return c.indexOf(a)!==-1}).sort(),e=b.difference(c,d);return this.$el.html(this.compiledTemplate({selectedfields:d,eventfields:e,r:this.model.result,m:this.model.event,_partial:this._partial,isSwapping:!1,_:b})),this},setFilter:function(a){this.filter=a},_partial:b.template('        <%  _(fields).each(function(field, i) { %>          <% var fieldlist = m.get(field) %>          <% if (_.isArray(fieldlist)) { %>            <% if(fieldlist.length > 1){ %>              <%  _(fieldlist).each(function(mv_field, j) { %>                <tr class="expand dashboards-table-tablerow <%- ((i+offset) % 2) ? "even" : "odd" %>">                  <% if(j==0) { %>                    <td rowspan="<%- fieldlist.length %>" class="col-visibility"><label class="checkbox" data-field-name="<%- field %>">                    <a href="#" data-name="Everyone.read" class="btn <%- iconVisibility ? "hide" : "show" %>-field">                    <% if(iconVisibility) { %>                     <i class="icon-check"></i>                     <% } %>                    </label></td>                  <% } %>                  <% if(j==0) {%>                    <td rowspan="<%- fieldlist.length %>" class="field-key">                      <span  data-field-name="<%- field %>"><%- field %></span>                    </td>                  <% } %>                  <td class="field-value">                    <%- mv_field %>                  </td>                </tr>              <% }) %>            <% } else { %>              <tr class="expand dashboards-table-tablerow <%- ((i+offset) % 2) ? "even" : "odd" %>">                <td rowspan="<%- fieldlist.length %>" class="col-visibility"><label class="checkbox" data-field-name="<%- field %>">                  <a href="#" data-name="Everyone.read" class="btn <%- iconVisibility ? "hide" : "show" %>-field">                  <% if(iconVisibility) { %>                    <i class="icon-check"></i>                  <% } %>                  </a></label>                </td>                <td class="field-key">                  <span  data-field-name="<%- field %>"><%- field %></span>                </td>                <td class="field-value">                    <%- m.get(field)[0] %>                </td>              </tr>            <% } %>          <% } %>        <% }); %>      '),template:'        <% if (!isSwapping) { %>          <table class="table table-condensed table-expanded table-striped">            <thead>              <th class="col-visibility"><label class="checkbox"><a href="#" class="btn disabled"><i class="icon-check"></i></a></label></th>              <th class="col-field-name"><%- _("Field").t() %></th>              <th class="col-field-value"><%- _("Value").t() %></th>            </thead>            <tbody>            <%= _partial({fields: selectedfields, iconVisibility: true, m: m, r:r, offset: 0}) %>            <%= _partial({fields: eventfields, iconVisibility: false, m: m, r:r, offset: selectedfields.length}) %>            </tbody>          </table>        <% } else { %>          <div class="event-fields-loading"><%- _("Loading...").t() %></div>        <% } %>      '})});