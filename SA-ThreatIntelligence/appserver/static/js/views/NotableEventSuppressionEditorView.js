"use strict";define(["underscore","backbone","jquery","util/splunkd_utils","views/Base","views/shared/Modal","views/shared/controls/ControlGroup","models/shared/DateInput","util/general_utils","css!./NotableEventSuppressionEditorView.css"],function(a,b,c,d,e,f,g,h){var i="edit-body",j="edit-footer",k=".edit-body",l=".edit-footer",m='<a href="#" class="btn cancel pull-left" data-dismiss="modal">'+a("Cancel").t()+"</a>",n='<a href="#" class="btn btn-primary pull-right">'+a("Save").t()+"</a>";return e.extend({template:'      <div class="'+i+'"></div>      <div class="'+j+'"></div>    ',template2:a.template('      <div class="adminContent">        <div class="adminIndex" id="es_no_permissions">          <div class="adminGroup">            <div class="adminListItem">              <a class="adminListIcon" style="background: url(${make_url(["static","img","skins","default","managerIcons","icon_access.png"])}) no-repeat 0px 0;"></a>              <dd>You do not have the necessary capabilities required to edit Notable Event Suppressions.  Please contact your Splunk administrator.</dd>            </div>          </div>        </div>      </div>    '),initialize:function(){this.expiration=new h,this.children.name=new g({label:a("Name").t(),required:!0,controlType:"Text",controlOptions:{model:this.model,modelAttribute:"name",placeholder:"Enter a unique name without spaces or special characters"}}),this.children.description=new g({label:a("Description (optional)").t(),controlType:"Text",controlOptions:{model:this.model,modelAttribute:"description",placeholder:"Enter a description of the suppression rule (optional)"}}),this.children.search=new g({label:a("Search").t(),controlType:"Textarea",controlOptions:{model:this.model,modelAttribute:"search"}}),this.children.expiration=new g({label:a("Expiration Time (optional)").t(),controlType:"Date",controlOptions:{model:this.expiration,validate:!0},help:a("The expiration time defines when the suppression will end;                events after this time will not be suppressed.").t()}),this.children.message=new g({label:"",controlType:"Label",error:!0,controlOptions:{model:this.model,modelAttribute:"errmsg"}})},events:{"click a.btn-primary":"save","click a.btn.cancel":"cancel"},setError:function(a){this.model.set("errmsg",a)},startListening:function(){this.listenTo(this.expiration,"change",function(a,b,c){var d=this.model.get("search").replace(/\s+_time\s*<\s*\d+/g,""),e=Math.floor(this.expiration.jsDate().valueOf()/1e3);newsearch=d+" _time<"+e,this.model.set("search",newsearch)}),this.listenTo(this.model,"change",function(){if(""!==this.model.get("errmsg")){var b=this.children.message,c=this.model;b.show(),a.delay(function(){b.$el.fadeOut(1e3),c.set("errmsg","",{silent:!0})},5e3)}})},save:function(){var b=this.model,c=this.children;a.each(c,function(a){a.$el.hasClass("error")&&(a.setHelpText(a._helpText),delete a._helpText,a.error(!1,""))});try{if(!b.isValid()){var d=b.validationError;return a.each(d,function(b,d){if(a.has(c,d)){var e=c[d];e.error(!0,b),e._helpText=e.$(".help-block").text(),e.setHelpText(b)}else console.error("Unknown field",d)}),!1}this.trigger("save")}catch(e){console.log(e),console.log(e.stack)}return!1},cancel:function(){return this.trigger("cancel"),!1},setPrimaryButtonState:function(a,b){var c=this.$("a.btn-primary");c.text(a),b===!0&&c.addClass("disable")},resetPrimaryButtonState:function(){var a=this.$("a.btn-primary");a.text("Save"),a.removeClass("disable")},render:function(){var b=this.model,c=b.get("is_new"),d=b.get("user").capabilities,e=a.indexOf(d,"edit_suppressions")>-1;if(!e)return this.$el.html(this.template2),this;this.$el.html(this.template);var f=this.$(k),g=this.$(l);return this.children.name.render().appendTo(f),this.children.description.render().appendTo(f),this.children.search.render().appendTo(f),this.children.expiration.render().appendTo(f),this.children.expiration.$("input[type=text]").val(""),this.children.expiration.$(".pull-left").removeClass("pull-left"),this.children.message.render().appendTo(f),this.children.message.hide(),c||(this.children.expiration.hide(),this.children.name.disable()),g.append(m),g.append(n),this}})});