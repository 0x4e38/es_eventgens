!function(a){"use strict";var b={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,externalTagId:!1,AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,tagList:null,fillInputOnTagRemove:!1},c={pushTag:function(b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q=a(this),r=q.data("opts"),s=q.data("tlis"),t=q.data("tlid");if(b=d.trimTag(b,r.delimiterChars),b&&!(b.length<=0)){if(r.onlyTagList&&void 0!==r.tagList&&r.tagList){var u=r.tagList;a.each(u,function(a,b){u[a]=b.toLowerCase()});var v=a.inArray(b.toLowerCase(),u);if(-1===v)return}r.CapitalizeFirstLetter&&b.length>1&&(b=b.charAt(0).toUpperCase()+b.slice(1).toLowerCase()),r.validator&&!r.validator(b)||r.maxTags>0&&s.length>=r.maxTags||(f=!1,g=jQuery.map(s,function(a){return a.toLowerCase()}),j=a.inArray(b.toLowerCase(),g),-1!==j&&(f=!0),f?(q.trigger("tm:duplicated",b),a("#"+q.data("tm_rndid")+"_"+t[j]).stop().animate({backgroundColor:r.blinkBGColor_1},100).animate({backgroundColor:r.blinkBGColor_2},100).animate({backgroundColor:r.blinkBGColor_1},100).animate({backgroundColor:r.blinkBGColor_2},100).animate({backgroundColor:r.blinkBGColor_1},100).animate({backgroundColor:r.blinkBGColor_2},100)):(r.externalTagId===!0?(void 0===e&&a.error("externalTagId is not passed for tag -"+b),i=e):(h=Math.max.apply(null,t),h=h===-(1/0)?0:h,i=++h),c||q.trigger("tm:pushing",[b,i]),s.push(b),t.push(i),c||null!==r.AjaxPush&&null==r.AjaxPushAllTags&&a.inArray(b,r.prefilled)===-1&&a.post(r.AjaxPush,a.extend({tag:b},r.AjaxPushParameters)),k=q.data("tm_rndid")+"_"+i,l=q.data("tm_rndid")+"_Remover_"+i,m=a("<span/>").text(b).html(),n='<span class="'+d.tagClasses.call(q)+'" id="'+k+'">',n+="<span>"+m+"</span>",n+='<a href="#" class="tm-tag-remove" id="'+l+'" TagIdToRemove="'+i+'">',n+=r.tagCloseIcon+"</a></span> ",o=a(n),null!==r.tagsContainer?a(r.tagsContainer).append(o):t.length>1?(p=a("#"+q.data("tm_rndid")+"_"+t[t.length-2]),p.after(o)):q.before(o),o.find("#"+l).on("click",q,function(b){b.preventDefault();var c=parseInt(a(this).attr("TagIdToRemove"));d.spliceTag.call(q,c,b.data)}),d.refreshHiddenTagList.call(q),c||q.trigger("tm:pushed",[b,i]),d.showOrHide.call(q)),q.val(""))}},popTag:function(){var b,c,e=a(this),f=e.data("tlis"),g=e.data("tlid");g.length>0&&(b=g.pop(),c=f[f.length-1],e.trigger("tm:popping",[c,b]),f.pop(),a("#"+e.data("tm_rndid")+"_"+b).remove(),d.refreshHiddenTagList.call(e),e.trigger("tm:popped",[c,b]))},empty:function(){for(var b,c=a(this),e=c.data("tlis"),f=c.data("tlid");f.length>0;)b=f.pop(),e.pop(),a("#"+c.data("tm_rndid")+"_"+b).remove(),d.refreshHiddenTagList.call(c);c.trigger("tm:emptied",null),d.showOrHide.call(c)},tags:function(){var a=this,b=a.data("tlis");return b}},d={showOrHide:function(){var a=this,b=a.data("opts"),c=a.data("tlis");b.maxTags>0&&c.length<b.maxTags&&(a.show(),a.trigger("tm:show")),b.maxTags>0&&c.length>=b.maxTags&&(a.hide(),a.trigger("tm:hide"))},tagClasses:function(){var b,c=a(this),d=c.data("opts"),e=d.tagBaseClass,f=d.inputBaseClass;return b=e,c.attr("class")&&a.each(c.attr("class").split(" "),function(a,c){c.indexOf(f+"-")!==-1&&(b+=" "+e+c.substring(f.length))}),b+=d.tagClass?" "+d.tagClass:""},trimTag:function(b,c){var d;for(b=a.trim(b),d=0;d<b.length&&a.inArray(b.charCodeAt(d),c)===-1;d++);return b.substring(0,d)},refreshHiddenTagList:function(){var b=a(this),c=b.data("tlis"),d=b.data("lhiddenTagList");d&&a(d).val(c.join(b.data("opts").baseDelimiter)).change(),b.trigger("tm:refresh",c.join(b.data("opts").baseDelimiter))},killEvent:function(a){a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation(),a.preventDefault()},keyInArray:function(b,c){return a.inArray(b.which,c)!==-1},applyDelimiter:function(b){var d=a(this);c.pushTag.call(d,a(this).val()),b.preventDefault()},prefill:function(b){var d=a(this);a.each(b,function(a,b){c.pushTag.call(d,b,!0)})},pushAllTags:function(b,c){var d=a(this),e=d.data("opts"),f=d.data("tlis");e.AjaxPushAllTags&&("tm:pushed"===b.type&&a.inArray(c,e.prefilled)!==-1||a.post(e.AjaxPush,a.extend({tags:f.join(e.baseDelimiter)},e.AjaxPushParameters)))},spliceTag:function(b){var c,e=this,f=e.data("tlis"),g=e.data("tlid"),h=a.inArray(b,g);-1!==h&&(c=f[h],e.trigger("tm:splicing",[c,b]),a("#"+e.data("tm_rndid")+"_"+b).remove(),f.splice(h,1),g.splice(h,1),d.refreshHiddenTagList.call(e),e.trigger("tm:spliced",[c,b])),d.showOrHide.call(e)},init:function(e){var f,g,h=a.extend({},b,e);return h.hiddenTagListName=null===h.hiddenTagListName?"hidden-"+this.attr("name"):h.hiddenTagListName,f=h.delimeters||h.delimiters,g=[9,13,17,18,19,37,38,39,40],h.delimiterChars=[],h.delimiterKeys=[],a.each(f,function(b,c){a.inArray(c,g)!==-1?h.delimiterKeys.push(c):h.delimiterChars.push(c)}),h.baseDelimiter=String.fromCharCode(h.delimiterChars[0]||44),h.tagBaseClass="tm-tag",h.inputBaseClass="tm-input",a.isFunction(h.validator)||(h.validator=null),this.each(function(){var b=a(this),e="",f="",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(b.data("tagManager"))return!1;b.data("tagManager",!0);for(var i=0;i<5;i++)f+=g.charAt(Math.floor(Math.random()*g.length));if(b.data("tm_rndid",f),b.data("opts",h).data("tlis",[]).data("tlid",[]),null===h.output?(e=a("<input/>",{type:"hidden",name:h.hiddenTagListName}),b.after(e),b.data("lhiddenTagList",e)):b.data("lhiddenTagList",a(h.output)),h.AjaxPushAllTags&&(b.on("tm:spliced",d.pushAllTags),b.on("tm:popped",d.pushAllTags),b.on("tm:pushed",d.pushAllTags)),b.on("focus keypress",function(b){a(this).popover&&a(this).popover("hide")}),h.isClearInputOnEsc&&b.on("keyup",function(b){27===b.which&&(a(this).val(""),d.killEvent(b))}),b.on("keypress",function(a){d.keyInArray(a,h.delimiterChars)&&d.applyDelimiter.call(b,a)}),b.on("keydown",function(a){13===a.which&&h.preventSubmitOnEnter&&d.killEvent(a),d.keyInArray(a,h.delimiterKeys)&&d.applyDelimiter.call(b,a)}),h.deleteTagsOnBackspace&&b.on("keydown",function(e){d.keyInArray(e,h.backspace)&&a(this).val().length<=0&&(c.popTag.call(b),d.killEvent(e))}),h.fillInputOnTagRemove&&b.on("tm:popped",function(b,c){a(this).val(c)}),b.change(function(a){/webkit/.test(navigator.userAgent.toLowerCase())||b.focus(),d.killEvent(a)}),null!==h.prefilled)"object"==typeof h.prefilled?d.prefill.call(b,h.prefilled):"string"==typeof h.prefilled?d.prefill.call(b,h.prefilled.split(h.baseDelimiter)):"function"==typeof h.prefilled&&d.prefill.call(b,h.prefilled());else if(null!==h.output){if(a(h.output)&&a(h.output).val()){a(h.output)}d.prefill.call(b,a(h.output).val().split(h.baseDelimiter))}}),this}};a.fn.tagsManager=function(b){var e=a(this);return 0 in this?c[b]?c[b].apply(e,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist."),!1):d.init.apply(this,arguments):this}}(jQuery);