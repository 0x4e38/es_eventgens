!function(a){a.widget("ui.dropdownchecklist",{version:function(){alert("DropDownCheckList v1.4")},_appendDropContainer:function(b){var c=a("<div/>");c.addClass("ui-dropdownchecklist ui-dropdownchecklist-dropcontainer-wrapper"),c.addClass("ui-widget"),c.attr("id",b.attr("id")+"-ddw"),c.css({position:"absolute",left:"-33000px",top:"-33000px"});var d=a("<div/>");return d.addClass("ui-dropdownchecklist-dropcontainer ui-widget-content"),d.css("overflow-y","auto"),c.append(d),c.insertAfter(b),c.isOpen=!1,c},_isDropDownKeyShortcut:function(b,c){return b.altKey&&a.ui.keyCode.DOWN==c},_isDropDownCloseKey:function(b,c){return a.ui.keyCode.ESCAPE==c||a.ui.keyCode.ENTER==c},_keyFocusChange:function(b,c,d){var e=a(":focusable"),f=e.index(b);if(f>=0){if(f+=c,d){var g=this.dropWrapper.find("input:not([disabled])"),h=e.index(g.get(0)),i=e.index(g.get(g.length-1));f<h?f=i:f>i&&(f=h)}e.get(f).focus()}},_handleKeyboard:function(b){var c=this,d=b.keyCode||b.which;!c.dropWrapper.isOpen&&c._isDropDownKeyShortcut(b,d)?(b.stopImmediatePropagation(),c._toggleDropContainer(!0)):c.dropWrapper.isOpen&&c._isDropDownCloseKey(b,d)?(b.stopImmediatePropagation(),c._toggleDropContainer(!1),c.controlSelector.focus()):!c.dropWrapper.isOpen||"checkbox"!=b.target.type||d!=a.ui.keyCode.DOWN&&d!=a.ui.keyCode.UP?c.dropWrapper.isOpen&&d==a.ui.keyCode.TAB:(b.stopImmediatePropagation(),c._keyFocusChange(b.target,d==a.ui.keyCode.DOWN?1:-1,!0))},_handleFocus:function(b,c,d){var e=this;d&&!e.dropWrapper.isOpen?(b.stopImmediatePropagation(),c?(e.controlSelector.addClass("ui-state-hover"),null!=a.ui.dropdownchecklist.gLastOpened&&a.ui.dropdownchecklist.gLastOpened._toggleDropContainer(!1)):e.controlSelector.removeClass("ui-state-hover")):d||c||(null!=b&&b.stopImmediatePropagation(),e.controlSelector.removeClass("ui-state-hover"),e._toggleDropContainer(!1))},_cancelBlur:function(a){var b=this;null!=b.blurringItem&&(clearTimeout(b.blurringItem),b.blurringItem=null)},_appendControl:function(){var b=this,c=this.sourceSelect,d=this.options,e=a("<span/>");e.addClass("ui-dropdownchecklist ui-dropdownchecklist-selector-wrapper ui-widget"),e.css({display:"inline-block",cursor:"default",overflow:"hidden"});var f=c.attr("id");f=null==f||""==f?"ddcl-"+a.ui.dropdownchecklist.gIDCounter++:"ddcl-"+f,e.attr("id",f);var g=a("<span/>");g.addClass("ui-dropdownchecklist-selector ui-state-default"),g.css({display:"inline-block",overflow:"hidden","white-space":"nowrap"});var h=c.attr("tabIndex");if(null==h?h=0:(h=parseInt(h),h<0&&(h=0)),g.attr("tabIndex",h),g.keyup(function(a){b._handleKeyboard(a)}),g.focus(function(a){b._handleFocus(a,!0,!0)}),g.blur(function(a){b._handleFocus(a,!1,!0)}),e.append(g),null!=d.icon){var i=null==d.icon.placement?"left":d.icon.placement,j=a("<div/>");j.addClass("ui-icon"),j.addClass(null!=d.icon.toOpen?d.icon.toOpen:"ui-icon-triangle-1-e"),j.css({"float":i}),g.append(j)}var k=a("<span/>");return k.addClass("ui-dropdownchecklist-text"),k.css({display:"inline-block","white-space":"nowrap",overflow:"hidden"}),g.append(k),e.hover(function(){b.disabled||g.addClass("ui-state-hover")},function(){b.disabled||g.removeClass("ui-state-hover")}),e.click(function(a){b.disabled||(a.stopImmediatePropagation(),b._toggleDropContainer(!b.dropWrapper.isOpen))}),e.insertAfter(c),a(window).resize(function(){!b.disabled&&b.dropWrapper.isOpen&&b._toggleDropContainer(!0)}),e},_createDropItem:function(b,c,d,e,f,g,h,i){var j=this,k=this.options,l=this.sourceSelect,m=this.controlWrapper,n=a("<div/>");n.addClass("ui-dropdownchecklist-item"),n.css({"white-space":"nowrap"});var o,p=g?' checked="checked"':"",q=h?' class="inactive"':' class="active"',r=m.attr("id"),s=r+"-i"+b;o=a(j.isMultiple?'<input disabled type="checkbox" id="'+s+'"'+p+q+' tabindex="'+c+'" />':'<input disabled type="radio" id="'+s+'" name="'+r+'"'+p+q+' tabindex="'+c+'" />'),o=o.attr("index",b).val(d),n.append(o);var t=a("<label for="+s+"/>");return t.addClass("ui-dropdownchecklist-text"),null!=f&&t.attr("style",f),t.css({cursor:"default"}),t.html(e),i&&n.addClass("ui-dropdownchecklist-indent"),n.addClass("ui-state-default"),h&&n.addClass("ui-state-disabled"),t.click(function(a){a.stopImmediatePropagation()}),n.append(t),n.hover(function(b){var c=a(this);c.hasClass("ui-state-disabled")||c.addClass("ui-state-hover")},function(b){var c=a(this);c.removeClass("ui-state-hover")}),o.click(function(b){var c=a(this);if(b.stopImmediatePropagation(),c.hasClass("active")){var d=j.options.onItemClick;if(a.isFunction(d))try{d.call(j,c,l.get(0))}catch(e){return c.prop("checked",!c.prop("checked")),void j._syncSelected(c)}j._syncSelected(c),j.sourceSelect.trigger("change","ddcl_internal"),!j.isMultiple&&k.closeRadioOnClick&&j._toggleDropContainer(!1)}}),n.click(function(b){var c=a(this);if(b.stopImmediatePropagation(),c.hasClass("ui-state-disabled"))c.focus(),j._cancelBlur();else{var d=c.find("input"),e=d.prop("checked");d.prop("checked",!e);var f=j.options.onItemClick;if(a.isFunction(f))try{f.call(j,d,l.get(0))}catch(g){return d.prop("checked",e),void j._syncSelected(d)}j._syncSelected(d),j.sourceSelect.trigger("change","ddcl_internal"),e||j.isMultiple||!k.closeRadioOnClick||j._toggleDropContainer(!1)}}),n.focus(function(b){a(this);b.stopImmediatePropagation()}),n.keyup(function(a){j._handleKeyboard(a)}),n},_createGroupItem:function(b,c){var d=this,e=a("<div />");e.addClass("ui-dropdownchecklist-group ui-widget-header"),c&&e.addClass("ui-state-disabled"),e.css({"white-space":"nowrap"});var f=a("<span/>");return f.addClass("ui-dropdownchecklist-text"),f.css({cursor:"default"}),f.text(b),e.append(f),e.click(function(b){var c=a(this);b.stopImmediatePropagation(),c.focus(),d._cancelBlur()}),e.focus(function(b){a(this);b.stopImmediatePropagation()}),e},_createCloseItem:function(b){var c=this,d=a("<div />");d.addClass("ui-state-default ui-dropdownchecklist-close ui-dropdownchecklist-item"),d.css({"white-space":"nowrap","text-align":"right"});var e=a("<span/>");return e.addClass("ui-dropdownchecklist-text"),e.css({cursor:"default"}),e.html(b),d.append(e),d.click(function(b){var d=a(this);b.stopImmediatePropagation(),d.focus(),c._toggleDropContainer(!1)}),d.hover(function(b){a(this).addClass("ui-state-hover")},function(b){a(this).removeClass("ui-state-hover")}),d.focus(function(b){a(this);b.stopImmediatePropagation()}),d},_appendItems:function(){var b=this,c=this.options,d=this.sourceSelect,e=this.dropWrapper,f=e.find(".ui-dropdownchecklist-dropcontainer");if(d.children().each(function(c){var d=a(this);if(d.is("option"))b._appendOption(d,f,c,!1,!1);else if(d.is("optgroup")){var e=d.prop("disabled"),g=d.attr("label");if(""!=g){var h=b._createGroupItem(g,e);f.append(h)}b._appendOptions(d,f,c,!0,e)}}),null!=c.explicitClose){var g=b._createCloseItem(c.explicitClose);f.append(g)}var h=f.outerWidth(),i=f.outerHeight();return{width:h,height:i}},_appendOptions:function(b,c,d,e,f){var g=this;b.children("option").each(function(b){var h=a(this),i=d+"."+b;g._appendOption(h,c,i,e,f)})},_appendOption:function(a,b,c,d,e){var f=this,g=a.html();if(null!=g&&""!=g){var h=a.val(),i=a.attr("style"),j=a.prop("selected"),k=e||a.prop("disabled"),l=f.controlSelector.attr("tabindex"),m=f._createDropItem(c,l,h,g,i,j,k,d);b.append(m)}},_syncSelected:function(b){var c=this,d=this.options,e=this.sourceSelect,f=this.dropWrapper,g=e.get(0).options,h=f.find("input.active");if("exclusive"==d.firstItemChecksAll)if(null==b&&a(g[0]).prop("selected"))h.prop("checked",!1),a(h[0]).prop("checked",!0);else if(null!=b&&0==b.attr("index")){var i=b.prop("checked");h.prop("checked",!1),a(h[0]).prop("checked",i)}else{var j=!0,k=null;h.each(function(b){if(b>0){var c=a(this).prop("checked");c||(j=!1)}else k=a(this)}),null!=k&&(j&&h.prop("checked",!1),k.prop("checked",j))}else if(d.firstItemChecksAll)if(null==b&&a(g[0]).prop("selected"))h.prop("checked",!0);else if(null!=b&&0==b.attr("index"))h.prop("checked",b.prop("checked"));else{var j=!0,k=null;h.each(function(b){if(b>0){var c=a(this).prop("checked");c||(j=!1)}else k=a(this)}),null!=k&&k.prop("checked",j)}var l=0;h=f.find("input"),h.each(function(b){var c=a(g[b+l]),d=c.html();null!=d&&""!=d||(l+=1,c=a(g[b+l])),c.prop("selected",a(this).prop("checked"))}),c._updateControlText(),null!=b&&b.focus()},_sourceSelectChangeHandler:function(a){var b=this,c=this.dropWrapper;c.find("input").val(b.sourceSelect.val()),b._updateControlText()},_updateControlText:function(){var a=this,b=this.sourceSelect,c=this.options,d=this.controlWrapper,e=b.find("option:first"),f=b.find("option"),g=a._formatText(f,c.firstItemChecksAll,e),h=d.find(".ui-dropdownchecklist-text");h.html(g),h.attr("title",h.text())},_formatText:function(b,c,d){var e;if(a.isFunction(this.options.textFormatFunction))try{e=this.options.textFormatFunction(b)}catch(f){alert("textFormatFunction failed: "+f)}else c&&null!=d&&d.prop("selected")?e=d.html():(e="",b.each(function(){if(a(this).prop("selected")){""!=e&&(e+=", ");var b=a(this).attr("style"),c=a("<span/>");c.html(a(this).html()),null==b?e+=c.html():(c.attr("style",b),e+=a("<span/>").append(c).html())}}),""==e&&(e=null!=this.options.emptyText?this.options.emptyText:"&nbsp;"));return e},_toggleDropContainer:function(b){var c=this,d=function(b){if(null!=b&&b.dropWrapper.isOpen){b.dropWrapper.isOpen=!1,a.ui.dropdownchecklist.gLastOpened=null;var c=b.options;b.dropWrapper.css({top:"-33000px",left:"-33000px"});var e=b.controlSelector;e.removeClass("ui-state-active"),e.removeClass("ui-state-hover");var f=b.controlWrapper.find(".ui-icon");if(f.length>0&&(f.removeClass(null!=c.icon.toClose?c.icon.toClose:"ui-icon-triangle-1-s"),f.addClass(null!=c.icon.toOpen?c.icon.toOpen:"ui-icon-triangle-1-e")),a(document).unbind("click",d),b.dropWrapper.find("input.active").prop("disabled",!0),a.isFunction(c.onComplete))try{c.onComplete.call(b,b.sourceSelect.get(0))}catch(g){alert("callback failed: "+g)}}},e=function(b){if(!b.dropWrapper.isOpen){b.dropWrapper.isOpen=!0,a.ui.dropdownchecklist.gLastOpened=b;var c=b.options;null==c.positionHow||"absolute"==c.positionHow?b.dropWrapper.css({position:"absolute",top:b.controlWrapper.position().top+b.controlWrapper.outerHeight()+"px",left:b.controlWrapper.position().left+"px"}):"relative"==c.positionHow&&b.dropWrapper.css({position:"relative",top:"0px",left:"0px"});var e=0;if(null==c.zIndex){var f=b.controlWrapper.parents().map(function(){var b=a(this).css("z-index");return isNaN(b)?0:b}).get(),g=Math.max.apply(Math,f);g>=0&&(e=g+1)}else e=parseInt(c.zIndex);e>0&&b.dropWrapper.css({"z-index":e});var h=b.controlSelector;h.addClass("ui-state-active"),h.removeClass("ui-state-hover");var i=b.controlWrapper.find(".ui-icon");i.length>0&&(i.removeClass(null!=c.icon.toOpen?c.icon.toOpen:"ui-icon-triangle-1-e"),i.addClass(null!=c.icon.toClose?c.icon.toClose:"ui-icon-triangle-1-s")),a(document).bind("click",function(a){d(b)});var j=b.dropWrapper.find("input.active");j.prop("disabled",!1);var k=j.get(0);null!=k&&k.focus()}};b?(d(a.ui.dropdownchecklist.gLastOpened),e(c)):d(c)},_setSize:function(b){var c=this.options,d=this.dropWrapper,e=this.controlWrapper,f=b.width;if(null!=c.width)f=parseInt(c.width);else if(null!=c.minWidth){var g=parseInt(c.minWidth);f<g&&(f=g)}var h=this.controlSelector;h.css({width:f+"px"});var i=h.find(".ui-dropdownchecklist-text"),j=h.find(".ui-icon");null!=j&&(f-=j.outerWidth()+4,i.css({width:f+"px"})),f=e.outerWidth();var k=null!=c.maxDropHeight?parseInt(c.maxDropHeight):-1,l=k>0&&b.height>k?k:b.height,m=b.width<f?f:b.width;a(d).css({height:l+"px",width:m+"px"}),d.find(".ui-dropdownchecklist-dropcontainer").css({height:l+"px"})},_init:function(){var b=this,c=this.options;null==a.ui.dropdownchecklist.gIDCounter&&(a.ui.dropdownchecklist.gIDCounter=1),b.blurringItem=null;var d=b.element;b.initialDisplay=d.css("display"),d.css("display","none"),b.initialMultiple=d.prop("multiple"),b.isMultiple=b.initialMultiple,null!=c.forceMultiple&&(b.isMultiple=c.forceMultiple),d.prop("multiple",!0),b.sourceSelect=d;var e=b._appendControl();b.controlWrapper=e,b.controlSelector=e.find(".ui-dropdownchecklist-selector");var f=b._appendDropContainer(e);b.dropWrapper=f;var g=b._appendItems();b._updateControlText(e,f,d),b._setSize(g),c.firstItemChecksAll&&b._syncSelected(null),c.bgiframe&&"function"==typeof b.dropWrapper.bgiframe&&b.dropWrapper.bgiframe(),b.sourceSelect.change(function(a,c){"ddcl_internal"!=c&&b._sourceSelectChangeHandler(a)})},_refreshOption:function(a,b,c){var d=a.parent();b?(a.prop("disabled",!0),a.removeClass("active"),a.addClass("inactive"),d.addClass("ui-state-disabled")):(a.prop("disabled",!1),a.removeClass("inactive"),a.addClass("active"),d.removeClass("ui-state-disabled")),a.prop("checked",c)},_refreshGroup:function(a,b){b?a.addClass("ui-state-disabled"):a.removeClass("ui-state-disabled")},close:function(){this._toggleDropContainer(!1)},refresh:function(){var b=this,c=this.sourceSelect,d=this.dropWrapper,e=d.find("input"),f=d.find(".ui-dropdownchecklist-group"),g=0,h=0;c.children().each(function(c){var d=a(this),i=d.prop("disabled");if(d.is("option")){var j=d.prop("selected"),k=a(e[h]);b._refreshOption(k,i,j),h+=1}else if(d.is("optgroup")){var l=d.attr("label");if(""!=l){var m=a(f[g]);b._refreshGroup(m,i),g+=1}d.children("option").each(function(){var c=a(this),d=i||c.prop("disabled"),f=c.prop("selected"),g=a(e[h]);b._refreshOption(g,d,f),h+=1})}}),b._syncSelected(null)},enable:function(){this.controlSelector.removeClass("ui-state-disabled"),this.disabled=!1},disable:function(){this.controlSelector.addClass("ui-state-disabled"),this.disabled=!0},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments),this.sourceSelect.css("display",this.initialDisplay),this.sourceSelect.prop("multiple",this.initialMultiple),this.controlWrapper.unbind().remove(),this.dropWrapper.remove()}}),a.extend(a.ui.dropdownchecklist,{defaults:{width:null,maxDropHeight:null,firstItemChecksAll:!1,closeRadioOnClick:!1,minWidth:50,positionHow:"absolute",bgiframe:!1,explicitClose:null}})}(jQuery);