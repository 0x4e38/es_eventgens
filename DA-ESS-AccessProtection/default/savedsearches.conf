
#####################
## Authentication
#####################

###### Correlation Searches ######
## SOLNESS-6481 Implement correlation search for detecting concurrent access attempts
[Access - Concurrent App Accesses - Rule]
action.email.sendresults            = 0
action.risk                         = 1
action.risk.param._risk_object      = user
action.risk.param._risk_object_type = user
action.risk.param._risk_score       = 20
alert.suppress                      = 1
alert.suppress.fields               = user
alert.suppress.period               = 86300s
alert.track                         = false
cron_schedule                       = 10 * * * *
disabled                            = True
dispatch.earliest_time              = -70m@m
dispatch.latest_time                = -5m@m
enableSched                         = 1
is_visible                          = false
request.ui_dispatch_app             = SplunkEnterpriseSecuritySuite
search                              = | tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.app,Authentication.src,Authentication.user span=1s | `drop_dm_object_name("Authentication")` | eventstats dc(src) as src_count by app,user | search src_count>1 | sort 0 + _time | streamstats current=t window=2 earliest(_time) as previous_time,earliest(src) as previous_src by app,user | where (src!=previous_src) | eval time_diff=abs(_time-previous_time) | where time_diff<300

[Access - High or Critical Priority Individual Logging into Infected Machine - Rule]
action.email.sendresults            = 0
action.risk                         = 1
action.risk.param._risk_object      = dest
action.risk.param._risk_object_type = system
action.risk.param._risk_score       = 100
action.notable                      = 1
## action.summary_index._name present for migration purposes
action.summary_index._name          = notable
alert.digest_mode                   = 1
alert.suppress                      = 1
alert.suppress.fields               = dest
alert.suppress.period               = 86300s
alert.track                         = false
cron_schedule                       = 10 * * * *
disabled                            = True
dispatch.earliest_time              = -24h
dispatch.latest_time                = +0s
dispatch.rt_backfill                = 1
enableSched                         = 1
is_visible                          = false
request.ui_dispatch_app             = SplunkEnterpriseSecuritySuite
search                              = | tstats allow_old_summaries=true values(Authentication.user) as "user" from datamodel=Authentication.Authentication where earliest=-65m@m latest=-5m@m nodename=Authentication.Successful_Authentication ("Authentication.user_priority"="high" OR "Authentication.user_priority"="critical") by "Authentication.dest" | rename "Authentication.dest" as "dest" | eval cs_key='dest' | join type=inner cs_key [| tstats allow_old_summaries=true values(Malware_Attacks.signature) as "signature" from datamodel=Malware.Malware_Attacks where earliest=-24h latest=+0s nodename=Malware_Attacks.Allowed_Malware  by "Malware_Attacks.dest" | rename "Malware_Attacks.dest" as "dest" | eval cs_key='dest']

## SOLNESS-6455 Implement correlation search for impossible travel detection. 
## This should run every hour, and scan events for the past 18 hours to detect login attempts from a given login 
## from two geographically distant locations.
[Access - Geographically Improbable Access Detected - Rule]
action.email.sendresults            = 0
action.notable                      = 1
## action.summary_index._name present for migration purposes
action.summary_index._name          = notable
action.risk                         = 1
action.risk.param._risk_object      = user
action.risk.param._risk_object_type = user
action.risk.param._risk_score       = 80
alert.digest_mode                   = 1
alert.suppress                      = 1
alert.suppress.fields               = user
alert.suppress.period               = 86300s
alert.track                         = false
cron_schedule                       = 5 * * * *
disabled                            = True
dispatch.earliest_time              = -1085m@m
dispatch.latest_time                = -5m@m
enableSched                         = 1
is_visible                          = false
request.ui_dispatch_app             = SplunkEnterpriseSecuritySuite
search                              = | tstats `summariesonly` values(Authentication.app) as app, latest(Authentication.user_bunit) as user_bunit from datamodel=Authentication.Authentication by Authentication.user,Authentication.src _time span=1s | `drop_dm_object_name("Authentication")` | eventstats dc(src) as src_count by user | search src_count>1  | sort 0 + _time| `get_asset(src)` | iplocation src | eval session_lat=if(isnull(src_lat), lat, src_lat) | eval session_lon=if(isnull(src_long), lon, src_long) | eval session_city=if(isnull(src_city), City, src_city)  | where isnotnull(session_lat) and isnotnull(session_lon) | sort 0 + _time  | streamstats current=t window=2 earliest(session_lat) as prev_lat, earliest(session_lon) as prev_lon, earliest(session_city) as prev_city, earliest(_time) as prev_time, earliest(src) as prev_src, latest(user_bunit) as user_bunit by user | where (src!=prev_src) | `globedistance(session_lat,session_lon,prev_lat,prev_lon,"m")` | eval time_diff=if((_time-prev_time)==0, 1, _time - prev_time) | eval speed = round(distance*3600/time_diff,2)| where speed>500
      
[Access - Short-lived Account Detected - Rule]
action.email.sendresults            = 0
action.risk                         = 1
action.risk.param._risk_object      = user
action.risk.param._risk_object_type = user
action.risk.param._risk_score       = 80
action.notable                      = 1
## action.summary_index._name present for migration purposes
action.summary_index._name          = notable
alert.suppress                      = 1
alert.suppress.fields               = user
alert.suppress.period               = 14400s
alert.track                         = 0
cron_schedule                       = */15 * * * *
disabled                            = True
dispatch.earliest_time              = -245m@m
dispatch.latest_time                = -5m@m
enableSched                         = 1
is_visible                          = false
request.ui_dispatch_app             = SplunkEnterpriseSecuritySuite
search                              = | tstats `summariesonly` count from datamodel=Change_Analysis.All_Changes where nodename="All_Changes.Account_Management" (All_Changes.action="created" OR All_Changes.action="deleted") by _time,All_Changes.dest,All_Changes.user span=1s | `drop_dm_object_name("All_Changes")` | streamstats range(_time) as delta,sum(count) as count by user,dest window=2 global=f | where count>1 AND delta<`useraccount_minimal_lifetime` | `uptime2string(delta,timestr)` | table user, dest, delta, timestr

###### Key Indicator Searches ######
[Access - Number Of Default Accounts In Use]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Default Accounts
action.keyindicator.subtitle                  = Distinct Accounts
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Default Accounts
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` estdc(Authentication.user) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s Authentication.user_category=default | appendcols [| tstats `summariesonly` estdc(Authentication.user) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h Authentication.user_category=default] | `get_delta`

[Access - Distinct Apps]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Auth. Apps
action.keyindicator.subtitle                  = Distinct Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = access_center
action.keyindicator.group.0.order             = 0
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Distinct Apps
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` estdc(Authentication.app) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.app) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`

[Access - Distinct Destinations]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Auth. Dest's
action.keyindicator.subtitle                  = Distinct Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = access_center
action.keyindicator.group.0.order             = 3
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Distinct Destinations
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` estdc(Authentication.dest) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.dest) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`

[Access - Distinct Sources]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Auth. Sources
action.keyindicator.subtitle                  = Distinct Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = access_center
action.keyindicator.group.0.order             = 2
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Distinct Sources
display.visualizations.show                   = 2
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` estdc(Authentication.src) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.src) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`

[Access - Distinct Users]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Auth. Users
action.keyindicator.subtitle                  = Distinct Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = access_center
action.keyindicator.group.0.order             = 4
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Distinct Users
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` estdc(Authentication.user) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.user) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`

[Access - Total Access Attempts]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Auth. Attempts
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = access_center
action.keyindicator.group.0.order             = 5
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Total Access Attempts
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` count as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_ksi_fields(current_count,historical_count)` | xsFindBestConcept current_count from count_1d in authentication as current_count_qual | xsfindbestconcept delta from percentile in default as delta_qual

###### Report Searches ######
[Access - Access Over Time]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -24h@h
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Authentication.Authentication by _time span=10m | timechart minspan=10m count

[Access - Access Over Time By Action]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -24h@h
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = area
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Authentication.Authentication by _time,Authentication.action span=10m | timechart minspan=10m useother=`useother` count by Authentication.action | `drop_dm_object_name("Authentication")`

[Access - Access Over Time By App]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -24h@h
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = area
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Authentication.Authentication by _time,Authentication.app span=10m | timechart minspan=10m useother=`useother` count by Authentication.app

[Access - Account Usage For Expired Identities]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -7d@d
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` max(_time) as _time,values(Authentication.dest) as dest from datamodel=Authentication.Authentication by Authentication.user | `drop_dm_object_name("Authentication")` | `get_identity4events(user)` | where isnotnull(user_endDate) | where _time>user_endDate | `uitime(user_endDate,"%m/%d/%Y %H:%M:%S")` | fields _time,user,user_first,user_last,user_endDate,dest

[Access - Default Account Usage Over Time]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -7d@d
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Authentication.Authentication where nodename=Authentication.Default_Authentication Authentication.action=success by _time span=1h | timechart minspan=1h count

[Access - Default Account Usage Over Time By App]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -7d@d
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Authentication.Authentication where nodename=Authentication.Default_Authentication Authentication.action=success by _time,Authentication.app span=1h | timechart minspan=1h count by Authentication.app | `drop_dm_object_name("Authentication")`

[Access - Default Accounts In Use]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` max(_time) as _time,values(Authentication.user_category) as user_category,dc(Authentication.dest) as dc(dest) from datamodel=Authentication.Authentication where Authentication.user_category=default by Authentication.user | `drop_dm_object_name("Authentication")` | sort 100 - _time | fields _time,user,user_category,dc(dest)

[Access - Default Local Accounts]
action.email.reportServerEnabled     = 0
alert.track                          = 0
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
request.ui_dispatch_app              = SplunkEnterpriseSecuritySuite
search                               = | `useraccounts_tracker` | search user_category=default | stats max(lastTime) as _time,values(user_category) as user_category,dc(dest) as dc(dest) by user | sort 100 - _time | fields _time,user,user_category,dc(dest)

[Access - First Time Account Access]
action.email.reportServerEnabled     = 0
alert.track                          = 0
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
request.ui_dispatch_app              = SplunkEnterpriseSecuritySuite
search                               = | inputlookup append=T access_tracker | stats min(firstTime) as firstTime,values(dest) as dest by user | sort 100 - firstTime | `uitime(firstTime)` | fields dest user firstTime

[Access - First Time Account Access Over Time]
action.email.reportServerEnabled          = 0
alert.track                               = 0
dispatch.earliest_time                    = -30d@d
dispatch.latest_time                      = now
dispatchAs                                = user
display.general.enablePreview             = 1
display.general.timeRangePicker.show      = false
display.general.type                      = visualizations
display.statistics.rowNumbers             = 0
display.statistics.wrap                   = 0
display.visualizations.charting.chart     = column
display.visualizations.charting.drilldown = all
display.visualizations.show               = 1
display.visualizations.type               = charting
request.ui_dispatch_app                   = SplunkEnterpriseSecuritySuite
search                                    = | inputlookup append=T access_tracker where `tracker_trp(firstTime_user,firstTime_user)` | rename firstTime as _time | timechart count

[Access - Inactive Accounts]
action.email.reportServerEnabled     = 0
alert.track                          = 0
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
request.ui_dispatch_app              = SplunkEnterpriseSecuritySuite
search                               = | `inactive_accounts(90)` | sort 100 + lastTime | `uitime(lastTime)` | fields user lastTime inactiveDays

[Access - Inactive Account Usage]
action.email.reportServerEnabled     = 0
alert.track                          = 0
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
request.ui_dispatch_app              = SplunkEnterpriseSecuritySuite
search                               = | `inactive_account_usage(90,24)` | sort 100 - lastTime | `uitime(second2lastTime)` | `uitime(lastTime)` | fields user second2lastTime lastTime inactiveDays

[Access - Notable Access Events]
action.email.reportServerEnabled          = 0
alert.track                               = 0
dispatch.earliest_time                    = -24h@h
dispatch.latest_time                      = now
display.general.enablePreview             = 1
display.general.type                      = visualizations
display.statistics.rowNumbers             = 0
display.statistics.wrap                   = 0
display.visualizations.charting.chart     = pie
display.visualizations.charting.drilldown = all
display.visualizations.show               = 1
request.ui_dispatch_app                   = SplunkEnterpriseSecuritySuite
search                                    = `notable` | search security_domain=access | stats sum(count) as count by rule_name

[Access - Privileged Account Usage Over Time]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -7d@d
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = connect
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Authentication.Authentication where nodename=Authentication.Privileged_Authentication by _time span=1h | timechart span=1h count

[Access - Privileged Accounts In Use]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` values(Authentication.user_category) as user_category,dc(Authentication.dest) as dest_count,max(_time) as lastTime from datamodel=Authentication.Authentication where Authentication.user_category=privileged by Authentication.user | `drop_dm_object_name("Authentication")` | sort 100 - lastTime | `uitime(lastTime)`

[Access - Top Access By Source]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name("Authentication")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by src | sort - count

[Access - Top Access By Destination]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.dest span=1h | `drop_dm_object_name("Authentication")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by dest | sort - count

[Access - Unique Access By App Count]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` values(Authentication.app) as app,count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name("Authentication")` | stats sparkline(sum(count),1h) as sparkline,dc(app) as app_count by src | sort - app_count

[Access - Unique Access By Destination Count]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` values(Authentication.dest) as dest,count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name("Authentication")` | stats sparkline(sum(count),1h) as sparkline,dc(dest) as dest_count by src | sort - dest_count

[Access - Unique Access By User Count]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` values(Authentication.user) as user,count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name("Authentication")` | stats sparkline(sum(count),1h) as sparkline,dc(user) as user_count by src | sort - user_count

###### Swim Lane Searches ######
[Access - All Authentication By Asset - Swimlane]
action.email.reportServerEnabled                  = 0
action.swimlane                                   = 1
action.swimlane.title                             = All Authentication
action.swimlane.color                             = blue
action.swimlane.constraint_method                 = reverse_asset_lookup
action.swimlane.constraint_fields                 = Authentication.src,Authentication.dest
action.swimlane.drilldown_search                  = | `datamodel("Authentication","Authentication")` | search $constraints$
alert.track                                       = 0
dispatch.latest_time                              = now
display.page.asset_investigator.0.collection_name = Default
display.page.asset_investigator.0.order           = 0
is_visible                                        = false
request.ui_dispatch_app                           = SplunkEnterpriseSecuritySuite
search                                            = | tstats `summariesonly` values(Authentication.action) as action,values(Authentication.app) as app,values(Authentication.src) as src,values(Authentication.dest) as dest,values(Authentication.user) as user,count from datamodel=Authentication.Authentication where $constraints$ by _time span=$span$

[Access - All Authentication By Identity - Swimlane]
action.email.reportServerEnabled                     = 0
action.swimlane                                      = 1
action.swimlane.title                                = All Authentication
action.swimlane.color                                = blue
action.swimlane.constraint_method                    = reverse_identity_lookup
action.swimlane.constraint_fields                    = Authentication.src_user,Authentication.user
action.swimlane.drilldown_search                     = | `datamodel("Authentication","Authentication")` | search $constraints$
alert.track                                          = 0
dispatch.latest_time                                 = now
display.page.identity_investigator.0.collection_name = Default
display.page.identity_investigator.0.order           = 0
is_visible                                           = false
request.ui_dispatch_app                              = SplunkEnterpriseSecuritySuite
search                                               = | tstats `summariesonly` values(Authentication.action) as action,values(Authentication.app) as app,values(Authentication.src) as src,values(Authentication.dest) as dest,values(Authentication.user) as user,count from datamodel=Authentication.Authentication where $constraints$ by _time span=$span$


#####################
## Account Management
#####################

###### Correlation Searches ######

###### Key Indicator Searches ######
[Change - Number Of Account Lockouts]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Account Lockouts
action.keyindicator.subtitle                  = Distinct Accounts
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
dispatch.earliest_time                        = -48h@h
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Account Lockouts
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
request.ui_dispatch_app                       = SplunkEnterpriseSecuritySuite
search                                        = | tstats `summariesonly` estdc(All_Changes.user) as current_count from datamodel=Change_Analysis.All_Changes where earliest=-24h@h latest=+0s nodename=All_Changes.Account_Management All_Changes.result="lockout" | appendcols [| tstats `summariesonly` estdc(All_Changes.user) as current_count from datamodel=Change_Analysis.All_Changes where earliest=-48h@h latest=-24h@h nodename=All_Changes.Account_Management All_Changes.result="lockout"] | `get_delta`

###### Report Searches ######
[Change - Account Lockouts]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` count from datamodel=Change_Analysis.All_Changes where nodename=All_Changes.Account_Management All_Changes.result="lockout" by All_Changes.src,All_Changes.Account_Management.src_nt_domain,All_Changes.user | sort 100 - count | `drop_dm_object_name("All_Changes")` |  `drop_dm_object_name("Account_Management")`

[Change - Account Management By Source User]
action.email.reportServerEnabled          = 0
alert.track                               = 0
dispatch.earliest_time                    = -24h
dispatch.latest_time                      = now
display.general.enablePreview             = 1
display.general.type                      = visualizations
display.statistics.rowNumbers             = 0
display.statistics.wrap                   = 0
display.visualizations.charting.chart     = bar
display.visualizations.charting.drilldown = all
display.visualizations.show               = 1
display.visualizations.type               = charting
request.ui_dispatch_app                   = SplunkEnterpriseSecuritySuite
search                                    = | tstats `summariesonly` count from datamodel=Change_Analysis.All_Changes where nodename=All_Changes.Account_Management by All_Changes.Account_Management.src_user| `drop_dm_object_name("All_Changes")` | `drop_dm_object_name("Account_Management")` | sort 10 - count

[Change - Account Management Over Time By Action]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -24h
dispatch.latest_time                                = now
dispatchAs                                          = user
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
request.ui_dispatch_app                             = SplunkEnterpriseSecuritySuite
search                                              = | `tstats` count from datamodel=Change_Analysis.All_Changes where nodename=All_Changes.Account_Management by _time,All_Changes.action span=10m | timechart minspan=10m useother=`useother` count by All_Changes.action | `drop_dm_object_name("All_Changes")`

[Change - Recent Account Management]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.earliest_time           = -24h@h
dispatch.latest_time             = now
display.events.fields            = ["action", "src", "src_nt_domain", "src_user", "dest", "dest_nt_domain", "user"]
display.events.list.wrap         = true
display.events.rowNumbers        = false
display.events.type              = list
display.general.enablePreview    = true
display.general.type             = events
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | `datamodel("Change_Analysis", "Account_Management")` | `drop_dm_object_name("All_Changes")` | `drop_dm_object_name("Account_Management")` | head 1000

[Change - Top Account Management Events]
action.email.reportServerEnabled = 0
alert.track                      = 0
dispatch.latest_time             = now
display.general.enablePreview    = 1
display.general.type             = statistics
display.statistics.drilldown     = row
display.statistics.rowNumbers    = 0
display.statistics.wrap          = 0
display.visualizations.show      = 0
request.ui_dispatch_app          = SplunkEnterpriseSecuritySuite
search                           = | tstats `summariesonly` count from datamodel=Change_Analysis.All_Changes where nodename=All_Changes.Account_Management by _time,All_Changes.action span=1h | `drop_dm_object_name("All_Changes")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by action | sort 10 - count
